#!/usr/bin/env python
"""
Generates all ascii characters in network encoding (big-endian) except for 0x00

"""
import codecs
import struct
import argparse


def gen_badchars(exclude_list):
    exclude = list()
    for el in exclude_list:
        # strip the 0x
        if el.startswith('0x') or el.startswith('\\x'):
            el = el[2:]
        exclude += codecs.decode(el, 'hex')
    badchars = ''
    for i in range(1, 256):
        _v = struct.pack("!B", i)
        if _v in exclude:
            print("Skipping value {}".format(repr(_v)))
            continue
        badchars += _v
    return badchars


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('-x', '--exclude', action='append',
                        help="Exclude hex values from badchars", default=[])
    parser.add_argument('-o', '--output', help="Output file (will overwrite)")
    args = parser.parse_args()

    badchars = gen_badchars(args.exclude)
    print(repr(badchars))
    if args.output is not None:
        with open(args.output, 'w') as f:
            f.write(badchars)


if __name__ == '__main__':
    main()
